{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/quizbinh2/src/app/dashboard/teacher/questions/actions.ts"],"sourcesContent":["'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { Question } from '@/lib/definitions';\n\n// --- CONFIGURATION ---\n// Lấy URL của API backend từ biến môi trường, với một giá trị dự phòng cho môi trường dev.\nconst API_URL = process.env.BACKEND_API_URL || 'http://localhost:5000/api';\n\n/**\n * Hàm helper để thực hiện các cuộc gọi API đã được xác thực đến backend.\n * Hàm này tập trung hóa logic fetch, cấu hình header, và xử lý lỗi.\n * \n * @param endpoint - Endpoint của API (ví dụ: '/questions').\n * @param method - Phương thức HTTP ('GET', 'POST', ...).\n * @param body - Dữ liệu JSON cho request.\n * @returns - Một object chứa dữ liệu hoặc thông báo lỗi.\n */\nasync function callApi(endpoint: string, method: 'POST' | 'GET' | 'PATCH' | 'DELETE', body?: any) {\n  const fullUrl = `${API_URL}${endpoint}`;\n\n  // !!! QUAN TRỌNG: Đây là placeholder cho logic xác thực của bạn.\n  // Bạn cần thay thế bằng cách lấy token của người dùng (ví dụ: từ session hoặc cookie).\n  const authToken = 'YOUR_HARDCODED_AUTH_TOKEN_FOR_NOW'; \n\n  try {\n    const response = await fetch(fullUrl, {\n      method: method,\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${authToken}`,\n      },\n      body: body ? JSON.stringify(body) : undefined,\n      // Luôn không cache các yêu cầu từ server action để đảm bảo dữ liệu mới nhất.\n      cache: 'no-store',\n    });\n\n    // Luôn cố gắng parse body của response, ngay cả khi response.ok là false.\n    const responseBody = await response.json();\n\n    if (!response.ok) {\n      console.error(`Lỗi API tại ${method} ${fullUrl}:`, responseBody);\n      // Ưu tiên sử dụng message lỗi từ backend.\n      throw new Error(responseBody.message || `Yêu cầu API thất bại với status ${response.status}`);\n    }\n\n    // Backend của bạn trả về dữ liệu trong một key 'data', ta sẽ trích xuất nó ở đây.\n    return { success: true, data: responseBody.data };\n\n  } catch (error) {\n    console.error(`Lỗi fetch trong Server Action đến ${fullUrl}:`, error);\n    const errorMessage = error instanceof Error ? error.message : 'Đã có lỗi không xác định ở server.';\n    return { success: false, error: errorMessage };\n  }\n}\n\n/**\n * Server Action để tạo cấu trúc câu hỏi từ text thô bằng dịch vụ AI.\n * Action này được gọi từ form phía client.\n * \n * @param rawText - Dữ liệu text chưa có cấu trúc từ người dùng.\n * @returns - Dữ liệu câu hỏi có cấu trúc từ AI hoặc lỗi.\n */\nexport async function generateQuestionWithAI(rawText: string) {\n  if (!rawText || typeof rawText !== 'string' || !rawText.trim()) {\n    return { success: false, error: 'Dữ liệu đầu vào không hợp lệ.' };\n  }\n\n  console.log(`[Action] Đang tạo câu hỏi từ text: \"${rawText.substring(0, 50)}...\"`);\n  return callApi('/questions/generateQuestion', 'POST', { rawQuestionText: rawText });\n}\n\n/**\n * Server Action để tạo một câu hỏi mới trong database.\n * Được gọi khi người dùng nhấn nút \"Lưu\".\n * \n * @param questionData - Object Question hoàn chỉnh, đã có cấu trúc.\n * @returns - Kết quả của hành động tạo mới.\n */\nexport async function createQuestionAction(questionData: Question) {\n  console.log('[Action] Đang lưu câu hỏi mới:', questionData.subQuestions[0]?.content);\n  \n  const result = await callApi('/questions', 'POST', questionData);\n\n  if (result.success) {\n    console.log('[Action] Revalidating đường dẫn: /dashboard/teacher/questions');\n    // Nếu lưu thành công, revalidate cache của trang danh sách câu hỏi.\n    // Điều này đảm bảo câu hỏi mới sẽ xuất hiện ngay lập tức.\n    revalidatePath('/dashboard/teacher/questions');\n  }\n\n  return result;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;;AAGA,wBAAwB;AACxB,2FAA2F;AAC3F,MAAM,UAAU,QAAQ,GAAG,CAAC,eAAe,IAAI;AAE/C;;;;;;;;CAQC,GACD,eAAe,QAAQ,QAAgB,EAAE,MAA2C,EAAE,IAAU;IAC9F,MAAM,UAAU,GAAG,UAAU,UAAU;IAEvC,iEAAiE;IACjE,uFAAuF;IACvF,MAAM,YAAY;IAElB,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,SAAS;YACpC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,WAAW;YACxC;YACA,MAAM,OAAO,KAAK,SAAS,CAAC,QAAQ;YACpC,6EAA6E;YAC7E,OAAO;QACT;QAEA,0EAA0E;QAC1E,MAAM,eAAe,MAAM,SAAS,IAAI;QAExC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,CAAC,YAAY,EAAE,OAAO,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE;YACnD,0CAA0C;YAC1C,MAAM,IAAI,MAAM,aAAa,OAAO,IAAI,CAAC,gCAAgC,EAAE,SAAS,MAAM,EAAE;QAC9F;QAEA,kFAAkF;QAClF,OAAO;YAAE,SAAS;YAAM,MAAM,aAAa,IAAI;QAAC;IAElD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,kCAAkC,EAAE,QAAQ,CAAC,CAAC,EAAE;QAC/D,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO;YAAE,SAAS;YAAO,OAAO;QAAa;IAC/C;AACF;AASO,eAAe,uBAAuB,OAAe;IAC1D,IAAI,CAAC,WAAW,OAAO,YAAY,YAAY,CAAC,QAAQ,IAAI,IAAI;QAC9D,OAAO;YAAE,SAAS;YAAO,OAAO;QAAgC;IAClE;IAEA,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,QAAQ,SAAS,CAAC,GAAG,IAAI,IAAI,CAAC;IACjF,OAAO,QAAQ,+BAA+B,QAAQ;QAAE,iBAAiB;IAAQ;AACnF;AASO,eAAe,qBAAqB,YAAsB;IAC/D,QAAQ,GAAG,CAAC,kCAAkC,aAAa,YAAY,CAAC,EAAE,EAAE;IAE5E,MAAM,SAAS,MAAM,QAAQ,cAAc,QAAQ;IAEnD,IAAI,OAAO,OAAO,EAAE;QAClB,QAAQ,GAAG,CAAC;QACZ,oEAAoE;QACpE,0DAA0D;QAC1D,IAAA,+IAAc,EAAC;IACjB;IAEA,OAAO;AACT;;;IA7BsB;IAgBA;;AAhBA,+OAAA;AAgBA,+OAAA"}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///home/user/quizbinh2/.next-internal/server/app/dashboard/teacher/questions/create/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateQuestionWithAI as '408b76bee2e24fd79af8a8a6bd23be9451d3ab4774'} from 'ACTIONS_MODULE0'\nexport {createQuestionAction as '40250f17555b511966689cc0bf9757be8e299f5b86'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}